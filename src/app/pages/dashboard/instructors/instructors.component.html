<div class="instructors-panel">
  <!-- Left List -->
  <div class="instructors-section">
    <div class="search-box">
      <mat-icon>search</mat-icon>
      <input type="text" placeholder="Search..." [(ngModel)]="searchValue" (ngModelChange)="onSearchChange()" />
    </div>
    <button class="add-btn" (click)="openAddDialog()">
      <mat-icon>person_add</mat-icon> Add Instructor
    </button>
    <div class="instructors-list">
      <div
        class="instructor-card"
        *ngFor="let person of filteredInstructors"
        [class.selected]="selectedInstructor === person"
        (click)="selectInstructor(person)">
        <img [src]="person.avatar || 'assets/placeholder.jpg'" class="instructor-avatar" />
        <div>
          <h4>{{person.name}}</h4>
          <p>{{person.email}}</p>
        </div>
        <div class="card-actions">
          <mat-icon class="edit-ic" (click)="openEditDialog(person); $event.stopPropagation();">edit</mat-icon>
          <mat-icon class="delete-ic" (click)="deleteInstructor(person); $event.stopPropagation();">delete</mat-icon>
        </div>
      </div>
      <div class="no-results" *ngIf="filteredInstructors.length === 0">
        <mat-icon>person_off</mat-icon>
        <span>No instructors found.</span>
      </div>
    </div>
  </div>

  <!-- Right Details (as Card) -->
  <div class="instructor-details">
    <ng-container *ngIf="selectedInstructor; else emptyDetails">
      <div class="details-card">
        <img [src]="selectedInstructor.avatar || 'assets/placeholder.jpg'" class="details-avatar" />
        <h3>{{ selectedInstructor.name }}</h3>
        <p class="details-email">
          <b>{{ selectedInstructor.email }}</b>
        </p>
        <div class="number-line" *ngIf="selectedInstructor.number">
          <mat-icon>call</mat-icon>
          <span>{{selectedInstructor.number}}</span>
        </div>
        <!-- عرض المواد -->
        <div class="subjects-inline" *ngIf="selectedInstructor.subjects.length">
          <mat-icon>menu_book</mat-icon>
          <span *ngFor="let subjId of selectedInstructor.subjects; let last = last">
            {{ getSubjectName(subjId) }}<span *ngIf="!last">,&nbsp;</span>
          </span>
        </div>
        <button class="add-btn" (click)="openSubjectDialog('edit')" style="margin-top:10px;">
          <mat-icon>add</mat-icon>
          Assign Subjects
        </button>
        <button class="edit-btn" (click)="openEditDialog(selectedInstructor)">
          <mat-icon>edit</mat-icon> Edit
        </button>
        <button class="delete-btn" (click)="deleteInstructor(selectedInstructor)">
          <mat-icon>delete</mat-icon> Delete
        </button>
      </div>
    </ng-container>
    <ng-template #emptyDetails>
      <div class="empty-details">
        <mat-icon>person_search</mat-icon>
        <p>Select instructor to see details</p>
      </div>
    </ng-template>
  </div>

  <!-- Modal Instructor (Add/Edit Instructor) -->
<!-- Modal (Add/Edit Instructor) -->
<div class="modal-backdrop" *ngIf="showDialog">
  <form class="modal-dialog animate-modal" (ngSubmit)="saveInstructor()">
    <label class="avatar-label">
      <img [src]="editInstructor.avatar || 'assets/placeholder.jpg'" class="edit-avatar" />
      <input type="file" accept="image/*" (change)="onAvatarChange($event)" />
      <span class="avatar-edit-ic"><mat-icon>camera_alt</mat-icon></span>
    </label>
    <input type="text" [(ngModel)]="editInstructor.name" name="name" placeholder="Name" required autocomplete="off" />
    <input type="email" [(ngModel)]="editInstructor.email" name="email" placeholder="Email" required autocomplete="off" />
    <input type="text" [(ngModel)]="editInstructor.number" name="number" placeholder="Number" autocomplete="off" />
    <input type="password" [(ngModel)]="editInstructor.password" name="password" placeholder="Password" autocomplete="off" />
    <button class="add-btn" type="button" (click)="openSubjectDialog('create')" style="margin:8px 0;">
      <mat-icon>add</mat-icon> Assign Subjects
    </button>
    <div *ngIf="editInstructor.subjects.length" class="assigned-subjects-preview">
      <span *ngFor="let subjId of editInstructor.subjects">
        {{ getSubjectName(subjId) }}
      </span>
    </div>
    <div class="modal-actions">
      <button type="submit" class="save-btn">
        <mat-icon>{{editMode ? 'save' : 'person_add_alt_1'}}</mat-icon> {{editMode ? 'Update' : 'Add'}}
      </button>
      <button type="button" class="cancel" (click)="showDialog=false">
        <mat-icon>close</mat-icon> Cancel
      </button>
    </div>
  </form>
</div>


  <!-- Modal اختيار المواد بشكل Card منبثق -->
  <div class="modal-backdrop" *ngIf="showSubjectDialog">
    <form class="modal-dialog modal-subjects-card" (ngSubmit)="saveSelectedSubjects()">
      <div class="modal-title-row">
        <mat-icon>menu_book</mat-icon>
        <h3>Select Subjects</h3>
        <button class="close-btn" type="button" (click)="showSubjectDialog = false">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <div class="modal-subjects-list">
        <label *ngFor="let subj of subjects" class="subject-option-row">
          <input type="checkbox"
            [checked]="subjectSelection.includes(subj.id)"
            (change)="onSubjectCheckboxChange($event, subj.id)" />
          <span>{{subj.name}}</span>
        </label>
      </div>
      <div class="modal-actions">
        <button type="submit" class="save-btn">Done</button>
        <button type="button" class="cancel" (click)="showSubjectDialog=false">Cancel</button>
      </div>
    </form>
  </div>
</div>
